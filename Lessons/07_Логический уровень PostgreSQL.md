## **Логический уровень PostgreSQL** ##


#### *Цели занятия:*
* иметь представление об логическом устройстве PostgreSQL;
* рассмотреть работу утилиты psql;
* объяснить как PostgreSQL работает с данными на логическом уровне.


#### *Краткое содержание:*
* логический уровень psql и системный каталог;
* работа с данными;
* практика.


#### *Результаты:*
* уверенно пользоваться консольной утилитой psql
1. конспект занятия: 
   * понимание модели работы с правами доступа пользователей;
   * умение задавать разные уровни настройки прав пользователей для разграничения доступа.


#### *Преподаватель:*
  * Михаил Ржевский


#### *Компетенции:*
1. владение базовыми навыками работы в SQL
   * понимание работы PostgreSQL на логическом уровне

#### *Дата и время:*
* 24 апреля, понедельник в 20:00
* Длительность занятия: 90 минут


#### *Материалы:*
* [PostgreSQL Privileges & User Management - What You Should Know](https://severalnines.com/blog/postgresql-privileges-user-management-what-you-should-know/)
* [Учебный PostgreS'L - LdAP Аутентификация на активный каталог](https://techexpert.tips/ru/postgresql-ru/postgresl-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0-%D0%BF%D0%BE%D0%B4%D0%BB%D0%B8%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8-ldap-%D0%BD%D0%B0-active-directory/)
* [GitHub - tds-fdw/tds_fdw: A PostgreSQL foreign data wrapper to connect to TDS databases (Sybase and Microsoft SQL Server)](https://github.com/tds-fdw/tds_fdw)
* [GitHub - laurenz/oracle_fdw: PostgreSQL Foreign Data Wrapper for Oracle](https://github.com/laurenz/oracle_fdw)
* [PostgreSQL Timelines and History File - Master Guide - postgreshelp](https://postgreshelp.com/postgresql-timelines/)
* [07 PG Логический уровень.pdf](https://cdn.otus.ru/media/private/14/1e/07_PG_%D0%9B%D0%BE%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D1%83%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8C-25239-141eda.pdf?hash=cqo7u_mz94FQsvLBJFvwLA&expires=1682390184)
* [Logical Level.zip](https://cdn.otus.ru/media/public/9e/62/Logical_Level-15865-9e6290.zip)
* [chat.txt](https://cdn.otus.ru/media/public/f4/f7/chat-15865-f4f7f4.txt)


#### *Домашнее задание:*
Работа с базами данных, пользователями и правами
* Цель:
    * создание новой базы данных, схемы и таблицы
    * создание роли для чтения данных из созданной схемы созданной базы данных
    * создание роли для чтения и записи из созданной схемы созданной базы данных


#### *Описание/Пошаговая инструкция выполнения домашнего задания:*
1. создайте новый кластер PostgresSQL 14
1. зайдите в созданный кластер под пользователем postgres
1. создайте новую базу данных testdb
1. зайдите в созданную базу данных под пользователем postgres
1. создайте новую схему testnm
1. создайте новую таблицу t1 с одной колонкой c1 типа integer
1. вставьте строку со значением c1=1
1. создайте новую роль readonly
1. дайте новой роли право на подключение к базе данных testdb
1. дайте новой роли право на использование схемы testnm
1. дайте новой роли право на select для всех таблиц схемы testnm
1. создайте пользователя testread с паролем test123
1. дайте роль readonly пользователю testread
1. зайдите под пользователем testread в базу данных testdb
1. сделайте select * from t1;
1. получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)
1. напишите что именно произошло в тексте домашнего задания
1. у вас есть идеи почему? ведь права то дали?
1. посмотрите на список таблиц
1. подсказка в шпаргалке под пунктом 20
1. а почему так получилось с таблицей (если делали сами и без шпаргалки то может у вас все нормально)
1. вернитесь в базу данных testdb под пользователем postgres
1. удалите таблицу t1
1. создайте ее заново но уже с явным указанием имени схемы testnm
1. вставьте строку со значением c1=1
1. зайдите под пользователем testread в базу данных testdb
1. сделайте select * from testnm.t1;
1. получилось?
1. есть идеи почему? если нет - смотрите шпаргалку
1. как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку
1. сделайте select * from testnm.t1;
1. получилось?
1. есть идеи почему? если нет - смотрите шпаргалку
1. сделайте select * from testnm.t1;
1. получилось?
1. ура!
1. теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);
1. а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?
1. есть идеи как убрать эти права? если нет - смотрите шпаргалку
1. если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды
1. теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);
1. расскажите что получилось и почему
