
  <div align="center"><h2> 7. Проверка отказоусточивости при Switchover и Failsafe в Patroni </h2></div>

***
### Описание проверки:
  * У нас настроен отказоустойчивый кластер на базе `Patroni` и в случает отказа сервера с мастером (failsafe/switchover) должно быть переключение мастера на другой сервер.
  * В первом тесте мы вручную переключим мастер на другой сервер. Это будет имитация случая, когда надо отдать сервер на плановое обслуживание или ремонт.
  * Во втором тесте мы сэмулируем падение/отключение сервера с мастером. При этом мастер должен автоматически переехать на дуруой сервер. А когда упавший сервер вернется в работу - `Patroni` должен восстанвоить его в качестве реплики.

*** 
### Список ВМ с которыми идет взаимодействие на данном этапе
  :hammer_and_wrench: Название ВМ | :memo: Внутренний IPv4 |
  |--------------:|---------------|
  | **`pg-srv1`** | `10.129.0.21` |
  | **`pg-srv2`** | `10.129.0.22` |      
  | **`pg-srv3`** | `10.129.0.23` |
  
***

### Выполняем первый тест, где мы вручную переключим мастер на другой сервер. Это будет имитация случая, когда надо отдать сервер на плановое обслуживание или ремонт.
  * Фиксируем начальное положение сервера с мастером.
    ```bash
    patronictl -c /etc/patroni/patroni.yml list
    ```
    ```console
    ubuntu@pg-srv1:~$ patronictl -c /etc/patroni/patroni.yml list
    + Cluster: pg-15-cluster ---------+-----------+----+-----------+
    | Member  | Host        | Role    | State     | TL | Lag in MB |
    +---------+-------------+---------+-----------+----+-----------+
    | pg-srv1 | 10.129.0.21 | Replica | streaming |  2 |         0 |
    | pg-srv2 | 10.129.0.22 | Replica | streaming |  2 |         0 |
    | pg-srv3 | 10.129.0.23 | Leader  | running   |  2 |           |
    +---------+-------------+---------+-----------+----+-----------+
    ubuntu@pg-srv1:~$ 
    ```
    <kbd>
      <img src="config_files/test_ha_patroni1.jpg" />
    </kbd>

  * Мы видим, что мастер находится на `pg-srv3` и текщий `TL=2`

  * Переключим мастер на другой сервер.


  * Проверим, что старый мастер стал репликой и не отстает. 
    

***
### Выполняем второй тест, где мы сэмулируем падение/отключение сервера с мастером. При этом мастер должен автоматически переехать на дуруой сервер. А когда упавший сервер вернется в работу - `Patroni` должен восстанвоить. 

***
### :+1: Проверка отказоусточивости при Switchover и Failsafe в Patroni пройдена!
